//@ui5-bundle aichatplugin/Component-preload.js
sap.ui.require.preload({
	"aichatplugin/Component.js":function(){
sap.ui.define(["sap/ui/core/Component","sap/base/util/ObjectPath","sap/m/Button","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/m/MessageToast"],function(e,t,s,n,r,o,a){return e.extend("aichatplugin.Component",{metadata:{manifest:"json"},init:function(){var e=this._getRenderer();var t=this.getModel("i18n").getResourceBundle();e.then(function(e){var n=new s({text:t.getText("buttonText"),press:this.onOpenChatPopover.bind(this)});e.setFooterControl("sap.m.Bar",{id:"myFooter",contentRight:[n]})}.bind(this))},onOpenChatPopover:function(e){if(!this._chatPopover){this._chatModel=new r({conversationId:self.crypto.randomUUID(),user_id:this._getUserInfo(),user_query:"",isBusy:false,enableTextArea:true,messages:[]});n.load({id:this.getId(),name:"aichatplugin.fragments.AiChatBox",controller:this}).then(function(t){this._chatPopover=t;e.getSource().addDependent(t);t.attachAfterOpen(()=>{this._attachEnterHandler()});t.setModel(this._chatModel,"chatModel");t.setModel(this.getModel());t.openBy(e.getSource())}.bind(this))}else if(this._chatPopover.isOpen()){this._chatPopover.close()}else{this._chatPopover.openBy(e.getSource())}},_attachEnterHandler:function(){const e=this.byFragmentId("chatInput");const t=e.getDomRef("inner");if(!t||this._bEnterHandler)return;t?.addEventListener("keydown",function(e){if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();this.onSendMessage()}}.bind(this));this._bEnterHandler=true},_getUserInfo:function(){const e=sap.ushell.Container.getService("UserInfo");return e.getEmail()||"dummy.user@com"},onSendMessage:function(){const e=this._chatModel.getProperty("/user_query");if(!e||!e.trim())return;this._chatModel.setProperty("/user_query","");var t=this.getModel();var s=new Date;var n=t.bindContext("/getChatRagResponse(...)");n.setParameter("conversationId",this._chatModel.getProperty("/conversationId"));n.setParameter("messageId",self.crypto.randomUUID());n.setParameter("message_time",s);n.setParameter("user_id",this._chatModel.getProperty("/user_id"));n.setParameter("user_query",e);const r=!(this._chatModel.getProperty("/messages")?.length>0);this._addChatMessage(e.trim(),s,"user");this._chatModel.setProperty("/isBusy",true);n.execute().then(()=>{this._chatModel.setProperty("/isBusy",false);if(r){this.byFragmentId("historyList").getBinding("items").refresh()}var e=n.getBoundContext();var t=e.getObject();if(t){this._addChatMessage(t.content,new Date(t.messageTime),t.role)}}).catch(e=>{this._chatModel.setProperty("/isBusy",false);this._refreshMessages(this._chatModel.getProperty("/conversationId"));a.show(e.message)})},_addChatMessage:function(e,t,s){const n=this._chatModel.getProperty("/messages")||[];n.push({user_id:s==="user"?this._chatModel.getProperty("/user_id"):"AI",user_query:e,message_time:t.toISOString(),user_role:s});this._chatModel.setProperty("/messages",n);setTimeout(function(){this.byFragmentId("chatMessageArea")?.scrollTo(0,9999,200)}.bind(this),0)},onNewChat:function(){this._chatModel.setProperty("/messages",[]);this._chatModel.setProperty("/conversationId",self.crypto.randomUUID())},onDeleteChat:function(e){var t=this.byFragmentId("historyList").getSelectedContexts();o.warning("This will delete your conversation permanently",{actions:["Remove",o.Action.CANCEL],onClose:e=>{if(e!=="Remove")return;const s=t.map(e=>e.delete().then(()=>{console.log("삭제 성공:",e)}).catch(e=>{console.error("삭제 실패:",e.message)}));Promise.all(s).then(()=>{console.log("모든 삭제 작업 완료!");this.onNewChat();this.byFragmentId("historyList").getBinding("items").refresh()})}})},onSelectHistory:function(e){const t=e.getSource();const s=t.getBindingContext().getProperty("cID");this._refreshMessages(s)},_refreshMessages:function(e){this._chatModel.setProperty("/messages",[]);this._chatModel.setProperty("/conversationId",e);this._chatModel.setProperty("/isBusy",true);var t=this.getModel().bindList(`/Conversation(${e})/to_messages`);t.requestContexts().then(e=>{e.map(e=>{var t=e.getObject();this._addChatMessage(t.content,new Date(t.creation_time),t.role)});this._chatModel.setProperty("/isBusy",false)}).catch(e=>{this._chatModel.setProperty("/isBusy",false);console.log("데이터 조회 실패: "+e.message)})},byFragmentId:function(e){return n.byId(this.getId(),e)},_getRenderer:function(){return new Promise(function(e,s){this._oShellContainer=t.get("sap.ushell.Container");if(!this._oShellContainer){s("Illegal state: shell container not available; this component must be executed in a unified shell runtime context.")}else{var n=this._oShellContainer.getRenderer();if(n){e(n)}else{this._onRendererCreated=function(t){n=t.getParameter("renderer");if(n){e(n)}else{s("Illegal state: shell renderer not available after receiving 'rendererLoaded' event.")}};this._oShellContainer.attachRendererCreatedEvent(this._onRendererCreated)}}}.bind(this))},exit:function(){if(this._oShellContainer&&this._onRendererCreated){this._oShellContainer.detachRendererCreatedEvent(this._onRendererCreated)}}})});
},
	"aichatplugin/fragments/AiChatBox.fragment.xml":'<core:FragmentDefinition\n    xmlns="sap.m"\n    xmlns:core="sap.ui.core"\n    xmlns:custom="aichatplugin.control"\n    xmlns:l="sap.ui.layout"><Popover\n        id="chatPopover"\n        title="AI Chat"\n        placement="Left"\n        resizable="true"\n        contentWidth="600px"\n        contentHeight="600px"\n        showHeader="true"\n        class="chatPopoverFull"\n        verticalScrolling="false"\n        horizontalScrolling="false"\n        showArrow="false"\n        footer="true"\n        offsetX="70"\n        offsetY="-380"><l:Splitter height="100%" id="mySplitter" class="chatSplitter"><VBox class="chatSidePane" id="chatHistoryArea"><List\n                    id="historyList"\n                    items="{\n                        path:\'/Conversation\',\n                        sorter:{\n                            path:\'last_update_time\',\n                            descending: true\n                        }\n                    }"\n                    mode="MultiSelect"\n                    sticky="HeaderToolbar"><headerToolbar><Toolbar id="historyListToolbar"><Title text="요약" level="H5" /><ToolbarSpacer /><Button icon="sap-icon://add" press=".onNewChat" /><Button icon="sap-icon://less" press="onDeleteChat" /></Toolbar></headerToolbar><StandardListItem title="{title}" description="{creation_time}" type="Active" press=".onSelectHistory"/><layoutData><FlexItemData growFactor="1"/></layoutData></List><layoutData><l:SplitterLayoutData size="250px"/></layoutData></VBox><ScrollContainer\n                id="chatMessageArea"\n                vertical="true"\n                class="chatScrollArea"\n                fitContainer="true"\n                busy="{chatModel>/isBusy}"\n                busyIndicatorDelay="0"><VBox id="chatMessages" items="{\n                        path:\'chatModel>/messages\',\n                        sorter:{\n                            path:\'message_time\',\n                            descending: false\n                        }\n                    }"><HBox justifyContent="{= ${chatModel>user_role} === \'user\' ? \'End\' : \'Start\' }"><VBox class="chatMessageBubble"><HBox justifyContent="SpaceBetween"><Text text="{chatModel>user_id}" class="chatSenderName" /><Text text="{chatModel>message_time}" class="chatTime" /></HBox><Text text="{chatModel>user_query}" class="chatText" /></VBox></HBox></VBox></ScrollContainer></l:Splitter><footer><HBox class="chatInputBox" alignItems="Stretch" fitContainer="true" busy="{chatModel>/isBusy}" busyIndicatorDelay="0"><TextArea\n                    id="chatInput"\n                    placeholder="Type your message..."\n                    growing="true"\n                    growingMaxLines="4"\n                    width="100%"\n                    liveChange=".onLiveChange"\n                    valueLiveUpdate="true"\n                    class="chatInputArea"\n                    rows="2"\n                    value="{chatModel>/user_query}"><layoutData><FlexItemData growFactor="1" /></layoutData></TextArea><Button icon="sap-icon://paper-plane" type="Emphasized" press=".onSendMessage" /></HBox></footer></Popover></core:FragmentDefinition>\n',
	"aichatplugin/i18n/i18n.properties":'pluginTitle=aiChatPlugin\npluginDescription=aiChatPlugin\nbuttonText=Ai Chat\nmsgMeAreaText=You pressed the button that opens a help page.\nmsgMeAreaTextApp=You pressed the button that opens a help for apps page.\n',
	"aichatplugin/manifest.json":'{"_version":"1.65.0","sap.app":{"_version":"1.3.0","id":"aichatplugin","type":"component","i18n":"i18n/i18n.properties","applicationVersion":{"version":"0.0.1"},"title":"{{pluginTitle}}","description":"{{pluginDescription}}","crossNavigation":{"inbounds":{"Shell-plugin":{"signature":{"parameters":{},"additionalParameters":"allowed"},"semanticObject":"Shell","action":"plugin","hideLauncher":true}}},"dataSources":{"mainService":{"uri":"odata/v4/chat/","type":"OData","settings":{"odataVersion":"4.0"}}}},"sap.ui":{"_version":"1.3.0","technology":"UI5","deviceTypes":{"desktop":true,"tablet":true,"phone":true}},"sap.ui5":{"_version":"1.2.0","contentDensities":{"compact":true,"cozy":false},"resources":{"css":[{"uri":"css/style.css"}]},"models":{"i18n":{"type":"sap.ui.model.resource.ResourceModel","settings":{"bundleName":"aichatplugin.i18n.i18n"}},"":{"type":"sap.ui.model.odata.v4.ODataModel","settings":{"synchronizationMode":"None","operationMode":"Server","autoExpandSelect":true},"dataSource":"mainService"}},"dependencies":{"minUI5Version":"1.38.1","libs":{"sap.ui.core":{"minVersion":"1.38.1"},"sap.m":{"minVersion":"1.38.1"}}},"componentName":"aichatplugin"},"sap.flp":{"type":"plugin","config":{}},"sap.cloud":{"public":true,"service":"aichatplugin"}}'
});
//# sourceMappingURL=Component-preload.js.map
